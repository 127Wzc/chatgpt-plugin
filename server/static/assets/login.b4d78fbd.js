import{K as P,L as D,M as U,o as b,O as p,bk as E,Q as w,a1 as N,D as t,S as a,aQ as L,a0 as u,aP as f,bl as M,aR as B,a4 as x,R as $,bm as Q,J as I,a7 as O,a6 as K,W as k,Z as W,a8 as j,_ as H,T as c,$ as v,H as F,bn as G,Y as y,U as J,aO as h,P as z}from"./index.69b87e29.js";import{a as Y,b as Z,c as X,d as ee}from"./auth-v1-tree.f5524167.js";import{m as te}from"./md5.69001cbf.js";import{b as T}from"./route-block.7577f022.js";import{V as ae}from"./VCheckbox.860dc908.js";import"./VCheckboxBtn.eae578de.js";const se={class:"auth-wrapper d-flex align-center justify-center pa-4 app-bar-region"},le={class:"d-flex"},oe=["innerHTML"],re=u("h5",{class:"text-h5 font-weight-semibold mb-1"}," \u6B22\u8FCE\u4F7F\u7528GPT\u5DE5\u5177\u7BB1 \u{1F44B}\u{1F3FB} ",-1),ne=u("p",{class:"mb-0"}," \u8BF7\u5148\u767B\u9646\u670D\u52A1\u8D26\u53F7 ",-1),ie={class:"d-flex align-center justify-space-between flex-wrap mt-1 mb-4"},ue=u("span",{class:"mx-4"},"or",-1),de=u("span",null,"\u65E0\u6CD5\u8FDE\u63A5\u5230\u670D\u52A1\u5668\uFF1F",-1),ce={__name:"login",setup(me){const s=P();D();const _=U(),g=b(()=>s.getters.ws.client),o=p({title:"",color:"warning",icon:"mdi-alert-circle-outline",text:""}),l=p({server:s.getters.serverApi,qq:"",password:"",remember:!1}),d=p(!1),q=E(),R=b(()=>q.global.name.value==="light"?Y:Z),m=p(!1),A=()=>{const n=l.value;if(d.value=!0,!n.server||!n.qq||!n.password){o.value.title="\u767B\u5F55\u5931\u8D25",o.value.text="\u8BF7\u586B\u5199\u670D\u52A1\u5668\u3001QQ\u53F7\u548C\u5BC6\u7801\u540E\u518D\u767B\u5F55",d.value=!1;return}let e=n.server;try{!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e=new URL(e).href}catch{o.value.title="\u767B\u5F55\u5931\u8D25",o.value.text="\u670D\u52A1\u5668\u5730\u5740\u683C\u5F0F\u9519\u8BEF",d.value=!1;return}const r=te(n.password);z.post(`${e}login`,{qq:n.qq,passwd:r}).then(i=>{if(i.data.login){if(s.getters.serverApi!=e||g.value.readyState!=1){const V=new URL(e),S=`${V.protocol==="http:"?"ws":"wss"}://${V.host}/ws`;s.dispatch("app/initWS",S)}s.commit("app/SET_RUNMODE","online"),s.commit("app/SET_APPSERVERAPI",e),s.dispatch("user/login",{user:n.qq,permissions:i.data.autho,token:i.data.token,auto:l.remember}),g.value.send(JSON.stringify({command:"login",token:s.getters.userToken})),s.commit("app/ADD_SNACKBAR",{message:`${n.qq}\u767B\u9646\u6210\u529F`,color:"success"}),_.push({path:"/"})}else l.value.password="",o.value.title="\u767B\u5F55\u5931\u8D25",o.value.text="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF",d.value=!1,s.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF\uFF01",color:"error"})}).catch(i=>{o.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",o.value.text=i.message,d.value=!1,s.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(i)})},C=()=>{s.commit("app/SET_RUNMODE","offline"),s.commit("app/SET_APPSERVERAPI",""),s.dispatch("user/login",{user:"\u79BB\u7EBF\u7528\u6237",permissions:"",token:"",auto:!1}),_.push({path:"/"})};return(n,e)=>(w(),N("div",se,[t(J,{class:"auth-card pa-4 pt-7 app-bar-noregion","max-width":"448"},{default:a(()=>[t(L,{class:"justify-center"},{prepend:a(()=>[u("div",le,[u("div",{innerHTML:f(M)},null,8,oe)])]),default:a(()=>[t(B,{class:"font-weight-semibold text-2xl text-uppercase"},{default:a(()=>[x(" GPT\u5DE5\u5177\u7BB1 ")]),_:1})]),_:1}),o.value.title?(w(),$(O,Q(I({key:0},o.value)),null,16)):K("",!0),t(k,{class:"pt-2"},{default:a(()=>[re,ne]),_:1}),t(k,null,{default:a(()=>[t(W,{onSubmit:e[5]||(e[5]=j(()=>{},["prevent"]))},{default:a(()=>[t(H,null,{default:a(()=>[t(c,{cols:"12"},{default:a(()=>[t(v,{modelValue:l.value.server,"onUpdate:modelValue":e[0]||(e[0]=r=>l.value.server=r),label:"\u670D\u52A1\u5668",type:"text"},null,8,["modelValue"])]),_:1}),t(c,{cols:"12"},{default:a(()=>[t(v,{modelValue:l.value.qq,"onUpdate:modelValue":e[1]||(e[1]=r=>l.value.qq=r),label:"QQ",type:"text"},null,8,["modelValue"])]),_:1}),t(c,{cols:"12"},{default:a(()=>[t(v,{modelValue:l.value.password,"onUpdate:modelValue":e[2]||(e[2]=r=>l.value.password=r),label:"\u5BC6\u7801",type:m.value?"text":"password","append-inner-icon":m.value?"mdi-eye-off-outline":"mdi-eye-outline","onClick:appendInner":e[3]||(e[3]=r=>m.value=!m.value)},null,8,["modelValue","type","append-inner-icon"]),u("div",ie,[t(ae,{modelValue:l.value.remember,"onUpdate:modelValue":e[4]||(e[4]=r=>l.value.remember=r),label:"\u81EA\u52A8\u767B\u9646"},null,8,["modelValue"])]),t(F,{block:"",type:"submit",loading:d.value,onClick:A},{loader:a(()=>[t(G,{indeterminate:"",color:"white"})]),default:a(()=>[x(" \u767B\u9646 ")]),_:1},8,["loading"])]),_:1}),t(c,{cols:"12",class:"d-flex align-center"},{default:a(()=>[t(y),ue,t(y)]),_:1}),t(c,{cols:"12",class:"text-center text-base"},{default:a(()=>[de,u("span",{class:"text-primary ms-2",onClick:C}," \u79BB\u7EBF\u4F7F\u7528 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(h,{class:"auth-footer-start-tree d-none d-md-block",src:f(X),width:250},null,8,["src"]),t(h,{src:f(ee),class:"auth-footer-end-tree d-none d-md-block",width:350},null,8,["src"]),t(h,{class:"auth-footer-mask d-none d-md-block",src:f(R)},null,8,["src"])]))}};typeof T=="function"&&T(ce);export{ce as default};

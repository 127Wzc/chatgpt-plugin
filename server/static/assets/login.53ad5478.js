import{p as z,b as G,bp as Y,bq as Z,bg as X,n as ee,v as te,ag as ae,u as le,C as se,o as k,O as y,ao as oe,aR as K,a$ as ne,ac as ue,ai as re,D as l,a2 as ie,bk as ce,J as O,aT as de,br as J,bs as M,K as pe,L as ve,M as me,bt as fe,Q as C,a1 as ge,S as p,aE as he,a0 as b,aD as T,bu as _e,aF as ye,a4 as W,R as B,bv as be,a7 as ke,a6 as L,W as Q,Z as Ae,aO as we,_ as Ve,T as D,$ as E,H as xe,Y as j,U as De,aC as I,P as $}from"./index.550d1358.js";import{a as Se,b as Re,c as qe,d as Ce}from"./auth-v1-tree.f5524167.js";import{m as Te}from"./md5.0c013eb9.js";import{b as H}from"./route-block.7577f022.js";const Ne=z({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"text"},...G(),...Y(),...Z(X({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Pe=ee()({name:"VOtpInput",props:Ne(),emits:{finish:n=>!0,"update:focused":n=>!0,"update:modelValue":n=>!0},setup(n,s){let{attrs:A,emit:S,slots:f}=s;const{dimensionStyles:u}=te(n),{isFocused:r,focus:w,blur:V}=ae(n),a=le(n,"modelValue","",t=>String(t).split(""),t=>t.join("")),{t:U}=se(),F=k(()=>Array(Number(n.length)).fill(0)),c=y(-1),R=y(),_=y([]),N=k(()=>_.value[c.value]);function P(){const t=a.value.slice(),d=N.value.value;t[c.value]=d,a.value=t;let h=null;c.value>a.value.length?h=a.value.length+1:c.value+1!==Number(n.length)?h="next":requestAnimationFrame(()=>{var v;return(v=N.value)==null?void 0:v.blur()}),h&&M(R.value,h)}function i(t){const d=a.value.slice(),h=c.value;let v=null;!["ArrowLeft","ArrowRight","Backspace","Delete"].includes(t.key)||(t.preventDefault(),t.key==="ArrowLeft"?v="prev":t.key==="ArrowRight"?v="next":["Backspace","Delete"].includes(t.key)&&(d[c.value]="",a.value=d,c.value>0&&t.key==="Backspace"?v="prev":requestAnimationFrame(()=>{_.value[h].select()})),requestAnimationFrame(()=>{v!=null&&M(R.value,v)}))}function e(t,d){var h,v,m;d.preventDefault(),d.stopPropagation(),a.value=((v=(h=d==null?void 0:d.clipboardData)==null?void 0:h.getData("Text"))!=null?v:"").split(""),(m=_.value)==null||m[t].blur()}function o(){a.value=[]}function g(t,d){w(),c.value=d}function x(){V(),c.value=-1}return oe({VField:{disabled:k(()=>n.disabled),error:k(()=>n.error),variant:k(()=>n.variant)}},{scoped:!0}),K(a,t=>{t.length===n.length&&S("finish",t.join(""))},{deep:!0}),K(c,t=>{t<0||ne&&window.requestAnimationFrame(()=>{_.value[t].select()})}),ue(()=>{var h;const[t,d]=re(A);return l("div",O({class:["v-otp-input",{"v-otp-input--divided":!!n.divider},n.class],style:[n.style]},t),[l("div",{ref:R,class:"v-otp-input__content",style:[u.value]},[F.value.map((v,m)=>l(ie,null,[n.divider&&m!==0&&l("span",{class:"v-otp-input__divider"},[n.divider]),l(ce,{focused:r.value&&n.focusAll||c.value===m,key:m},{...f,default:()=>l("input",{ref:q=>_.value[m]=q,"aria-label":U(n.label,m+1),autofocus:m===0&&n.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],inputmode:"text",min:n.type==="number"?0:void 0,maxlength:"1",placeholder:n.placeholder,type:n.type,value:a.value[m],onInput:P,onFocus:q=>g(q,m),onBlur:x,onKeydown:i,onPaste:q=>e(m,q)},null)})])),l("input",O({class:"v-otp-input-input",type:"hidden"},d,{value:a.value.join("")}),null),l(de,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!n.loading,persistent:!0},{default:()=>{var v,m;return[(m=(v=f.loader)==null?void 0:v.call(f))!=null?m:l(J,{color:typeof n.loading=="boolean"?void 0:n.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(h=f.default)==null?void 0:h.call(f)])])}),{blur:()=>{var t;(t=_.value)==null||t.some(d=>d.blur())},focus:()=>{var t;(t=_.value)==null||t[0].focus()},reset:o,isFocused:r}}});const Be={class:"auth-wrapper d-flex align-center justify-center pa-4 app-bar-region"},Le={class:"d-flex"},Ue=["innerHTML"],Fe=b("h5",{class:"text-h5 font-weight-semibold mb-1"}," \u6B22\u8FCE\u4F7F\u7528GPT\u5DE5\u5177\u7BB1 \u{1F44B}\u{1F3FB} ",-1),Ee=b("p",{class:"mb-0"}," \u8BF7\u5148\u767B\u9646\u670D\u52A1\u8D26\u53F7 ",-1),Ie=b("p",{class:"mb-0"}," \u5FEB\u6377\u767B\u5F55 ",-1),$e=b("span",{class:"mx-4"},"or",-1),Oe=b("span",null,"\u65E0\u6CD5\u8FDE\u63A5\u5230\u670D\u52A1\u5668\uFF1F",-1),Ke={__name:"login",setup(n){const s=pe(),A=ve(),S=me(),f=k(()=>s.getters.ws.client),u=y({title:"",color:"warning",icon:"mdi-alert-circle-outline",text:""}),r=y({server:s.getters.serverApi,qq:"",password:"",remember:!1}),w=y(""),V=y(),a=y(!1),U=fe(),F=k(()=>U.global.name.value==="light"?Se:Re),c=y(!1),R=()=>{const i=r.value;if(a.value=!0,!i.server||!i.qq||!i.password){u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u8BF7\u586B\u5199\u670D\u52A1\u5668\u3001QQ\u53F7\u548C\u5BC6\u7801\u540E\u518D\u767B\u5F55",a.value=!1;return}let e=i.server;try{!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e=new URL(e).href}catch{u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u5730\u5740\u683C\u5F0F\u9519\u8BEF",a.value=!1;return}const o=Te(i.password);$.post(`${e}login`,{qq:i.qq,passwd:o}).then(g=>{if(g.data.login){if(s.getters.serverApi!=e||f.value.readyState!=1){const x=new URL(e),t=`${x.protocol==="http:"?"ws":"wss"}://${x.host}/ws`;s.dispatch("app/initWS",t)}s.commit("app/SET_RUNMODE","online"),s.commit("app/SET_APPSERVERAPI",e),s.dispatch("user/login",{user:i.qq,permissions:g.data.autho,token:g.data.token,auto:r.remember}),setTimeout(()=>{f.value.readyState==1?(f.value.send(JSON.stringify({command:"login",token:s.getters.userToken})),s.commit("app/ADD_SNACKBAR",{message:`${i.qq}\u767B\u9646\u6210\u529F`,color:"success"}),S.push({path:"/"})):(s.commit("app/ADD_SNACKBAR",{message:"ws\u94FE\u63A5\u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",color:"warning"}),a.value=!1)},1e3)}else r.value.password="",u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF",a.value=!1,s.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF\uFF01",color:"error"})}).catch(g=>{u.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",u.value.text=g.message,a.value=!1,s.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(g)})},_=()=>{s.commit("app/SET_RUNMODE","offline"),s.commit("app/SET_APPSERVERAPI",""),s.dispatch("user/login",{user:"\u79BB\u7EBF\u7528\u6237",permissions:"",token:"",auto:!1}),S.push({path:"/"})},N=()=>{const i=r.value;if(a.value=!0,!i.server){u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u8BF7\u586B\u5199\u670D\u52A1\u5668\u540E\u518D\u767B\u5F55",a.value=!1;return}let e=i.server;try{!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e=new URL(e).href}catch{u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u5730\u5740\u683C\u5F0F\u9519\u8BEF",a.value=!1;return}$.post(`${e}quick`).then(o=>{a.value=!1,o.data.state?V.value=!0:(r.value.password="",u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u9519\u8BEF",s.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u9519\u8BEF\uFF01",color:"error"}))}).catch(o=>{u.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",u.value.text=o.message,a.value=!1,s.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(o)})},P=()=>{a.value=!0;const i=r.value;let e=i.server;try{!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),e=new URL(e).href}catch{u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u670D\u52A1\u5668\u5730\u5740\u683C\u5F0F\u9519\u8BEF",a.value=!1;return}$.post(`${e}login`,{otp:w.value}).then(o=>{if(o.data.login){if(s.getters.serverApi!=e||f.value.readyState!=1){const g=new URL(e),x=`${g.protocol==="http:"?"ws":"wss"}://${g.host}/ws`;s.dispatch("app/initWS",x)}s.commit("app/SET_RUNMODE","online"),s.commit("app/SET_APPSERVERAPI",e),s.dispatch("user/login",{user:o.data.user,permissions:o.data.autho,token:o.data.token,auto:r.remember}),setTimeout(()=>{f.value.readyState==1?(f.value.send(JSON.stringify({command:"login",token:s.getters.userToken})),s.commit("app/ADD_SNACKBAR",{message:`${i.qq}\u767B\u9646\u6210\u529F`,color:"success"}),S.push({path:"/"})):(s.commit("app/ADD_SNACKBAR",{message:"ws\u94FE\u63A5\u5C1A\u672A\u5B8C\u6210\u521D\u59CB\u5316\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",color:"warning"}),a.value=!1)},1e3)}else r.value.password="",u.value.title="\u767B\u5F55\u5931\u8D25",u.value.text="\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF",a.value=!1,s.commit("app/ADD_SNACKBAR",{message:"\u767B\u5F55\u5931\u8D25\uFF0C\u7528\u6237\u540D\u6216\u5BC6\u7801\u9519\u8BEF\uFF01",color:"error"})}).catch(o=>{u.value.title="\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38",u.value.text=o.message,a.value=!1,s.commit("app/ADD_SNACKBAR",{message:"\u767B\u9646\u5931\u8D25\uFF0C\u670D\u52A1\u5668\u53D1\u751F\u5F02\u5E38\uFF01",color:"error"}),console.log(o)})};return A.query.server&&A.query.otp&&(r.value.server=A.query.server,w.value=A.query.otp,P()),(i,e)=>(C(),ge("div",Be,[l(De,{class:"auth-card pa-4 pt-7 app-bar-noregion","max-width":"448"},{default:p(()=>[l(he,{class:"justify-center"},{prepend:p(()=>[b("div",Le,[b("div",{innerHTML:T(_e)},null,8,Ue)])]),default:p(()=>[l(ye,{class:"font-weight-semibold text-2xl text-uppercase"},{default:p(()=>[W(" GPT\u5DE5\u5177\u7BB1 ")]),_:1})]),_:1}),u.value.title?(C(),B(ke,be(O({key:0},u.value)),null,16)):L("",!0),l(Q,{class:"pt-2"},{default:p(()=>[Fe,Ee]),_:1}),l(Q,null,{default:p(()=>[l(Ae,{onSubmit:e[5]||(e[5]=we(()=>{},["prevent"]))},{default:p(()=>[l(Ve,null,{default:p(()=>[l(D,{cols:"12"},{default:p(()=>[l(E,{modelValue:r.value.server,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.server=o),label:"\u670D\u52A1\u5668",type:"text","append-inner-icon":"mdi-fingerprint","onClick:appendInner":N},null,8,["modelValue"])]),_:1}),V.value?(C(),B(D,{key:0,cols:"12"},{default:p(()=>[Ie,l(T(Pe),{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),loading:a.value,onFinish:P},null,8,["modelValue","loading"])]),_:1})):L("",!0),V.value?L("",!0):(C(),B(D,{key:1,cols:"12"},{default:p(()=>[l(E,{modelValue:r.value.qq,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.qq=o),label:"QQ",type:"text"},null,8,["modelValue"])]),_:1})),V.value?L("",!0):(C(),B(D,{key:2,cols:"12"},{default:p(()=>[l(E,{modelValue:r.value.password,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.password=o),label:"\u5BC6\u7801",type:c.value?"text":"password","append-inner-icon":c.value?"mdi-eye-off-outline":"mdi-eye-outline","onClick:appendInner":e[4]||(e[4]=o=>c.value=!c.value),class:"mb-4"},null,8,["modelValue","type","append-inner-icon"]),l(xe,{block:"",type:"submit",loading:a.value,onClick:R},{loader:p(()=>[l(J,{indeterminate:"",color:"white"})]),default:p(()=>[W(" \u767B\u9646 ")]),_:1},8,["loading"])]),_:1})),l(D,{cols:"12",class:"d-flex align-center"},{default:p(()=>[l(j),$e,l(j)]),_:1}),l(D,{cols:"12",class:"text-center text-base"},{default:p(()=>[Oe,b("span",{class:"text-primary ms-2",onClick:_}," \u79BB\u7EBF\u4F7F\u7528 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(I,{class:"auth-footer-start-tree d-none d-md-block",src:T(qe),width:250},null,8,["src"]),l(I,{src:T(Ce),class:"auth-footer-end-tree d-none d-md-block",width:350},null,8,["src"]),l(I,{class:"auth-footer-mask d-none d-md-block",src:T(F)},null,8,["src"])]))}};typeof H=="function"&&H(Ke);export{Ke as default};
